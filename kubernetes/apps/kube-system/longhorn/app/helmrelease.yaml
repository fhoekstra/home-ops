---
# yaml-language-server: $schema=https://raw.githubusercontent.com/fluxcd-community/flux2-schemas/main/helmrelease-helm-v2.json
apiVersion: helm.toolkit.fluxcd.io/v2
kind: HelmRelease
metadata:
  name: longhorn
spec:
  interval: 30m
  chart:
    spec:
      chart: longhorn
      version: v1.8.0
      sourceRef:
        kind: HelmRepository
        name: longhorn
        namespace: flux-system
  install:
    remediation:
      retries: 3
  upgrade:
    cleanupOnFail: true
    remediation:
      retries: 3
  values:
    defaultSettings:
      # -- Percentage of storage that can be allocated relative to hard drive capacity. The default value is "100".
      storageOverProvisioningPercentage: 100
      # -- Percentage of minimum available disk capacity. When the minimum available capacity exceeds the total available capacity, the disk becomes unschedulable until more space is made available for use. The default value is "25".
      storageMinimalAvailablePercentage: 25
      # -- Percentage of the total allocatable CPU resources on each node to be reserved for each instance manager pod when the V1 Data Engine is enabled. The default value is "12".
      guaranteedInstanceManagerCPU: 12
    persistence:
      defaultDataLocality: best-effort
    ingress:
      enabled: true
      host: longhorn.${SECRET_DOMAIN}
      path: /
      ingressClassName: internal
    metrics:
      serviceMonitor:
        enabled: true
